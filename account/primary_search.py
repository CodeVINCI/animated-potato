from home.models import Post
from datetime import datetime, timedelta
import re

class NewsArticleSearch:
    def newsarticles(self,search_query):
        date_today=str(datetime.today())
        date_today=date_today[:10]
        d = str(datetime.today() - timedelta(days=7))
        d=d[:10]
        all_posts=Post.objects.filter(date__range=[d,date_today])
        ranked=[]
        terms=search_query.split(" ")

        common_terms=['near','the', 'of', 'to', 'and', 'a', 'in', 'is', 'it', 'you', 'that', 'he', 'was', 'for', 'on', 'are', 'with', 'as', 'I', 'his', 'they', 'be', 'at', 'one', 'have', 'this', 'from', 'or', 'had', 'by', 'hot', 'word', 'but', 'what', 'some', 'we', 'can', 'out', 'other', 'were', 'all', 'there', 'when', 'up', 'use', 'your', 'how', 'said', 'an', 'each', 'she', 'which', 'do', 'their', 'time', 'if', 'will', 'way', 'about', 'many', 'then', 'them', 'write', 'would', 'like', 'so', 'these', 'her', 'long', 'make', 'thing', 'see', 'him', 'two', 'has', 'look', 'more', 'day', 'could', 'go', 'come', 'did', 'number', 'sound', 'no', 'most', 'people', 'my', 'over', 'know', 'water', 'than', 'call', 'first', 'who', 'may', 'down', 'side', 'been', 'now', 'find', 'any', 'new', 'work', 'part', 'take', 'get', 'place', 'made', 'live', 'where', 'after', 'back', 'little', 'only', 'round', 'man', 'year', 'came', 'show', 'every', 'good', 'me', 'give', 'our', 'under', 'name', 'very', 'through', 'just', 'form', 'sentence', 'great', 'think', 'say', 'help', 'low', 'line', 'differ', 'turn', 'cause', 'much', 'mean', 'before', 'move', 'right', 'boy', 'old', 'too', 'same', 'tell']
        for post in all_posts:
            rank=0
            for term in terms:
                if term not in common_terms:
                    pattern= term.encode('utf-8')
                    matchobj=re.search(pattern,post.headline,re.IGNORECASE)
                    if matchobj:
                        rank=rank+1
            if rank >0:
                ranked.append((post,rank))
        return ranked




